---
layout: post
title: Drupal 8 and content security policies
comments: true
disqus_id: csp-drupal-8
lead: "A <em><b>Content Security Policy</b></em> is a HTTP response header that helps reduce XSS risks by declaring which resources can be included by your wesbite."
tags:
  - Drupal 8
  - CSP
---

First we should explore what a content security policy (CSP) actually is and how it can benefit your site. A CSP is a directives based whitelist that is delivered when your page is requested. These directives instruct the browser how it should handle including resources from alien domains.

The [CSP](https://content-security-policy.com/) recommendation has a number of resources that you can use to help harden your website. Some of the common ones that are implemented:

- `script-src`
- `style-src`
- `img-src`
- `font-src`

These directives should contain a whitelist of domains that you want to allow for your website. It is important to remember that if you haven't defined a particular directive in your CSP the default browser implementation will allow all domains.

Let's say we need to include Google Analytic tracking, this requires us to trust a third-party source. If we don't define a CSP the third-party is implicitly trusted, however this means that the third-party could also include scripts from another place. You may never actually know what scripts are being included nor will you know exactly what they're doing.

To ensure that only the script that you're expecting is included you should add directives to your CSP definition which could look like:

```
Content-Security-Policy: script-src 'self' www.google-analytics.com;img-src www.google-analytics.com;
```

This directive would ensure that:

- Scripts can be executed from your domain (using the `self` keyword)
- Scripts can be included from *http* or *https* `www.google-analytics.com`
- Images can be included from `www.google-analytics.com`

Anything that falls outside of these allowed domains would be blocked by the browser and not be allowed to execute on your page. Conversely the missing directives from your CSP would have the browser default, allowing everything.

## Implementing in Drupal

### Security Kit (seckit)

The [security kit](http://drupal.org/project/seckit) module provides allows managing of various security-hardening options via the UI. One of the options that it exposes is the ability to control the CSP.

![Seckit UI](/img/seckit-ui.png)

## Further reading

* [https://content-security-policy.com/](https://content-security-policy.com/)
* [https://developers.google.com/web/fundamentals/security/csp/](https://developers.google.com/web/fundamentals/security/csp/)
* [https://en.wikipedia.org/wiki/Cross-origin_resource_sharing](https://en.wikipedia.org/wiki/Cross-origin_resource_sharing)
* [https://en.wikipedia.org/wiki/Content_Security_Policy](https://en.wikipedia.org/wiki/Content_Security_Policy)
* [https://blog.twitter.com/2011/improving-browser-security-with-csp](https://blog.twitter.com/2011/improving-browser-security-with-csp)
